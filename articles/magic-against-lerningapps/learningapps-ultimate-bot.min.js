const cards=document.querySelector('iframe[src^="https://learningapps.org/show.php"]').contentDocument.querySelectorAll(".cardOuter .card");if(!cards.length)throw alert("Nothing to do..."),TypeError("No cards has been found in this page");if(!confirm("Are you sure to use magic on this page? A good wizard makes sure they've mastered everything they need to learn."))throw Error("Operation ended by user");let guid_list=[],regex=/openApp\('https:\/\/learningapps\.org\/watch\?v=([^']+)/;cards.forEach(e=>{guid_list.push({elem:e,guid:e.getAttribute("onclick").match(regex)[1]})});const c=new URL(location.href).searchParams.get("v"),time=5,userName=document.querySelector('iframe[src^="https://learningapps.org/show.php"]').contentDocument.querySelector("#usernameDisplay").innerText,headers={accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8","sec-ch-ua":'"Chromium";v="130", "Microsoft Edge";v="130", "Not?A_Brand";v="99"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors"};function getElementViewportCoordinates(e){let t=e.getBoundingClientRect();return{x:t.left,y:t.top}}async function moveMagicStick(e,t,r,a){let o=document.querySelector("#magic-stick");return o||((o=document.createElement("div")).id="magic-stick",o.style.transform=`translate(${e}px, ${t}px)`,document.body.appendChild(o)),new Promise(e=>{o.getBoundingClientRect(),o.style.transform=`translate(${r}px, ${a}px)`,o.addEventListener("transitionend",function t(){o.removeEventListener("transitionend",t),e()})})}function sleep(e){return new Promise(t=>setTimeout(t,e))}function playSpinAnimation(e,t){let r=document.createElement("span");r.className="ripples",r.style.left=e+"px",r.style.top=t+"px",document.body.appendChild(r),setTimeout(()=>{r.remove()},2e3)}function playBellDing(e,t=1){if(e){var r=new Audio("https://xiuhengwu.github.io/src/file-stored/"+e);r.volume=t,r.play()}}function showMessage(e){let t=document.querySelector(".blackboard");t||((t=document.createElement("div")).className="blackboard",document.body.append(t)),t.innerHTML=e}async function processGuids(e){let t=500,r=500,a=document.createElement("style");a.innerHTML=`
    .solvedCheckmark, .cardOuter {
        transition: opacity 1s;
    }
    .cardOuter {
        perspective: 100px;
    }
    .card {
        animation: point 1s cubic-bezier(0,-0.68, 1, 2.51);
        animation-play-state: paused;
    }
    @keyframes point {
        from {
            transform: rotateX(0deg) rotateY(0deg);
        }
        50% {
            transform: rotateX(1deg) rotateY(1deg);
        }
        to {
            transform: rotateX(0deg) rotateY(0deg);
        }
    }
    `;let o=document.createElement("style");o.innerHTML=`
    #magic-stick {
        position: fixed;
        width: 100px;
        height: 100px;
        left: 0;
        top: 0;
        background-image: url(https://xiuhengwu.github.io/src/file-stored/magic-stick.webp);
        background-size: cover;
        transition: transform 1s;
    }
    @keyframes point-backward {
        from {
            transform: rotateX(0deg) rotateY(0deg);
        }
        50% {
            transform: rotateX(-1deg) rotateY(1deg);
        }
        to {
            transform: rotateX(0deg) rotateY(0deg);
        }
    }
    body {
        perspective: 100px;
    }
    body > span.ripples {
        background-color: yellow;
        border-radius: 50%;
        pointer-events: none;
        position: fixed;
        transform: translate(-50%, -50%);
        animation: animate 2s ease-out infinite;
    }
    @keyframes animate {
        from {
            width: 0;
            height: 0;
            opacity: 0.5;
        }
        to {
            width: 100vmin;
            height: 100vmin;
            opacity: 0;
        }
    }
    @font-face {
        font-family: "blackletter";
        src: url("https://xiuhengwu.github.io/src/file-stored/blackletter.ttf");
    }
    .blackboard {
        font-family: blackletter;
        font-size: 30px;
        position: fixed;
        width: 80%;
        background: black;
        color: white;
        bottom: 7%;
        left: 10%;
        min-height: 150px;
        box-shadow: 0px 0px 50px 30px rgba(0,0,0,0.8);
        padding: 10px;
        animation: fade-in 1s;
        transition: opacity 1s;
    }
    @keyframes fade-in {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    `,document.querySelector('iframe[src^="https://learningapps.org/show.php"]').contentDocument.head.append(a),document.head.append(o),["copper-bell-ding.mp3","ship-bell-two-chimes.mp3"].forEach(e=>{var t=new Audio;t.src="https://xiuhengwu.github.io/src/file-stored/"+e,t.preload="auto",t.load()});let i=0;for(let n of e){let s,l,p;await fetch("https://learningapps.org/setAppSolved.php",{method:"POST",headers:headers,body:`guid=${n.guid}&value=100&time=5&user=0`}).then(e=>e.text()).then(e=>{console.log(e),s=e}).catch(e=>{console.error("Error:",e),s=e}),await fetch("https://learningapps.org/collection.php",{method:"POST",headers:headers,body:`u=${userName}&c=${c}`}).then(e=>e.text()).then(e=>{console.log(e),l=e}).catch(e=>{console.error("Error:",e),s=e}),await fetch("https://learningapps.org/collection.php",{method:"POST",headers:headers,body:`u=${userName}&a=${n.guid}&c=${c}&t=5`}).then(e=>e.text()).then(e=>{console.log(e),p=e}).catch(e=>{console.error("Error:",e),s=e});let d=document.createElement("div");d.className="solvedCheckmark",d.style.opacity="0",d.innerText="âœ“",n.elem.querySelector(".caption").appendChild(d);let h=getElementViewportCoordinates(d).x,m=getElementViewportCoordinates(d).y;await moveMagicStick(t,r,h,m),d.style.opacity="1",n.elem.parentNode.classList.remove("disabledCard"),n.elem.style["animation-play-state"]="running",playBellDing("copper-bell-ding.mp3",.4),playSpinAnimation(h,m),t=h,r=m,showMessage(`PRECESSING ... <br>BASE: ${c}, GUID: ${n.guid}, PROGRESS: ${++i} / ${e.length} <br><div style="font-size: 70%; font-family: blackletter">RES0: ${s}<br>RES1: ${l}<br>RES2: ${p}</div>`)}await sleep(1e3),await moveMagicStick(t,r,window.innerWidth/2,window.innerHeight/2),playSpinAnimation(window.innerWidth/2,window.innerHeight/2),playBellDing("ship-bell-two-chimes.mp3"),showMessage('<h1 style="text-align: center; font-family: blackletter">FINISHED !</h1>'),await sleep(2e3),document.querySelector(".blackboard").style.opacity="0",document.querySelector("#magic-stick").remove()}processGuids(guid_list);